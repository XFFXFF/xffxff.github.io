<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/github.min.css"/><title>从 AutoGPT 学习如何发挥 GPT 的潜力</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/7eb40cdb0d262f08.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7eb40cdb0d262f08.css" data-n-g=""/><link rel="preload" href="/_next/static/css/69a316e8a13b4830.css" as="style"/><link rel="stylesheet" href="/_next/static/css/69a316e8a13b4830.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-e70c6273bfe3f237.js" defer=""></script><script src="/_next/static/chunks/main-d719a31ca00eb19c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fcb060ba8fa2b368.js" defer=""></script><script src="/_next/static/chunks/640-1a3a0dc0790efd2e.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-03d1a37039c741de.js" defer=""></script><script src="/_next/static/AXSw0rpNiwbWX6q4wUGrM/_buildManifest.js" defer=""></script><script src="/_next/static/AXSw0rpNiwbWX6q4wUGrM/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="layout_container__fbLkO"><main><article><h1 class="utils_headingXl__u25Y2">从 AutoGPT 学习如何发挥 GPT 的潜力</h1><div class="utils_lightText__eUzGY"><time dateTime="2023-04-19">April 19, 2023</time></div><div><p>项目地址：<a href="https://github.com/Significant-Gravitas/Auto-GPT">https://github.com/Significant-Gravitas/Auto-GPT</a></p>
<h2>Prompt 构造</h2>
<p>AutoGPT 的 prompt <a href="https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/chat.py#L27-L49">包含多条 message</a></p>
<p>这里主要看看其中一条，也是最主要的</p>
<pre><code class="hljs language-vbnet"><span class="hljs-comment">'You are Tennis-GPT, An AI for creating tennis training plan</span>
Your decisions must always be made independently without seeking user assistance. Play <span class="hljs-keyword">to</span> your strengths <span class="hljs-keyword">as</span> an LLM <span class="hljs-built_in">and</span> pursue simple strategies <span class="hljs-keyword">with</span> no legal complications.

<span class="hljs-symbol">GOALS:</span>

<span class="hljs-number">1</span>. Aim <span class="hljs-keyword">to</span> achieve an amateur level <span class="hljs-keyword">of</span> <span class="hljs-number">2.5</span> <span class="hljs-keyword">for</span> tennis beginners.
<span class="hljs-number">2</span>. Practice at home.


<span class="hljs-symbol">Constraints:</span>
<span class="hljs-number">1</span>. ~<span class="hljs-number">4000</span> word limit <span class="hljs-keyword">for</span> <span class="hljs-type">short</span> term memory. Your <span class="hljs-type">short</span> term memory <span class="hljs-built_in">is</span> <span class="hljs-type">short</span>, so immediately save important information <span class="hljs-keyword">to</span> files.
<span class="hljs-number">2</span>. <span class="hljs-keyword">If</span> you are unsure how you previously did something <span class="hljs-built_in">or</span> want <span class="hljs-keyword">to</span> recall past events, thinking about similar events will help you remember.
<span class="hljs-number">3</span>. No user assistance
<span class="hljs-number">4</span>. Exclusively use the commands listed <span class="hljs-keyword">in</span> <span class="hljs-type">double</span> quotes e.g. <span class="hljs-string">"command name"</span>

<span class="hljs-symbol">Commands:</span>
<span class="hljs-number">1</span>. Google Search: <span class="hljs-string">"google"</span>, args: <span class="hljs-string">"input"</span>: <span class="hljs-string">"&#x3C;search>"</span>
<span class="hljs-number">2</span>. Browse Website: <span class="hljs-string">"browse_website"</span>, args: <span class="hljs-string">"url"</span>: <span class="hljs-string">"&#x3C;url>"</span>, <span class="hljs-string">"question"</span>: <span class="hljs-string">"&#x3C;what_you_want_to_find_on_website>"</span>
<span class="hljs-number">3</span>. Start GPT Agent: <span class="hljs-string">"start_agent"</span>, args: <span class="hljs-string">"name"</span>: <span class="hljs-string">"&#x3C;name>"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">"&#x3C;short_task_desc>"</span>, <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"&#x3C;prompt>"</span>
<span class="hljs-number">4</span>. Message GPT Agent: <span class="hljs-string">"message_agent"</span>, args: <span class="hljs-string">"key"</span>: <span class="hljs-string">"&#x3C;key>"</span>, <span class="hljs-string">"message"</span>: <span class="hljs-string">"&#x3C;message>"</span>
<span class="hljs-number">5</span>. List GPT Agents: <span class="hljs-string">"list_agents"</span>, args:
<span class="hljs-number">6</span>. Delete GPT Agent: <span class="hljs-string">"delete_agent"</span>, args: <span class="hljs-string">"key"</span>: <span class="hljs-string">"&#x3C;key>"</span>
<span class="hljs-number">7</span>. Clone Repository: <span class="hljs-string">"clone_repository"</span>, args: <span class="hljs-string">"repository_url"</span>: <span class="hljs-string">"&#x3C;url>"</span>, <span class="hljs-string">"clone_path"</span>: <span class="hljs-string">"&#x3C;directory>"</span>
<span class="hljs-number">8</span>. Write <span class="hljs-keyword">to</span> file: <span class="hljs-string">"write_to_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>, <span class="hljs-string">"text"</span>: <span class="hljs-string">"&#x3C;text>"</span>
<span class="hljs-number">9</span>. Read file: <span class="hljs-string">"read_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>
<span class="hljs-number">10</span>. Append <span class="hljs-keyword">to</span> file: <span class="hljs-string">"append_to_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>, <span class="hljs-string">"text"</span>: <span class="hljs-string">"&#x3C;text>"</span>
<span class="hljs-number">11</span>. Delete file: <span class="hljs-string">"delete_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>
<span class="hljs-number">12</span>. Search Files: <span class="hljs-string">"search_files"</span>, args: <span class="hljs-string">"directory"</span>: <span class="hljs-string">"&#x3C;directory>"</span>
<span class="hljs-number">13</span>. Evaluate Code: <span class="hljs-string">"evaluate_code"</span>, args: <span class="hljs-string">"code"</span>: <span class="hljs-string">"&#x3C;full_code_string>"</span>
<span class="hljs-number">14</span>. <span class="hljs-keyword">Get</span> Improved Code: <span class="hljs-string">"improve_code"</span>, args: <span class="hljs-string">"suggestions"</span>: <span class="hljs-string">"&#x3C;list_of_suggestions>"</span>, <span class="hljs-string">"code"</span>: <span class="hljs-string">"&#x3C;full_code_string>"</span>
<span class="hljs-number">15</span>. Write Tests: <span class="hljs-string">"write_tests"</span>, args: <span class="hljs-string">"code"</span>: <span class="hljs-string">"&#x3C;full_code_string>"</span>, <span class="hljs-string">"focus"</span>: <span class="hljs-string">"&#x3C;list_of_focus_areas>"</span>
<span class="hljs-number">16</span>. Execute Python File: <span class="hljs-string">"execute_python_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>
<span class="hljs-number">17</span>. Generate Image: <span class="hljs-string">"generate_image"</span>, args: <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"&#x3C;prompt>"</span>
<span class="hljs-number">18</span>. Send Tweet: <span class="hljs-string">"send_tweet"</span>, args: <span class="hljs-string">"text"</span>: <span class="hljs-string">"&#x3C;text>"</span>
<span class="hljs-number">19</span>. Convert Audio <span class="hljs-keyword">to</span> <span class="hljs-keyword">text</span>: <span class="hljs-string">"read_audio_from_file"</span>, args: <span class="hljs-string">"file"</span>: <span class="hljs-string">"&#x3C;file>"</span>
<span class="hljs-number">20</span>. <span class="hljs-keyword">Do</span> <span class="hljs-literal">Nothing</span>: <span class="hljs-string">"do_nothing"</span>, args:
<span class="hljs-number">21</span>. Task Complete (Shutdown): <span class="hljs-string">"task_complete"</span>, args: <span class="hljs-string">"reason"</span>: <span class="hljs-string">"&#x3C;reason>"</span>

<span class="hljs-symbol">Resources:</span>
<span class="hljs-number">1</span>. Internet access <span class="hljs-keyword">for</span> searches <span class="hljs-built_in">and</span> information gathering.
<span class="hljs-number">2</span>. <span class="hljs-type">Long</span> Term memory management.
<span class="hljs-number">3</span>. GPT-<span class="hljs-number">3.5</span> powered Agents <span class="hljs-keyword">for</span> delegation <span class="hljs-keyword">of</span> simple tasks.
<span class="hljs-number">4</span>. File output.

Performance Evaluation:
<span class="hljs-number">1</span>. Continuously review <span class="hljs-built_in">and</span> analyze your actions <span class="hljs-keyword">to</span> ensure you are performing <span class="hljs-keyword">to</span> the best <span class="hljs-keyword">of</span> your abilities.
<span class="hljs-number">2</span>. Constructively self-criticize your big-picture behavior constantly.
<span class="hljs-number">3</span>. Reflect <span class="hljs-keyword">on</span> past decisions <span class="hljs-built_in">and</span> strategies <span class="hljs-keyword">to</span> refine your approach.
<span class="hljs-number">4</span>. Every command has a cost, so be smart <span class="hljs-built_in">and</span> efficient. Aim <span class="hljs-keyword">to</span> complete tasks <span class="hljs-keyword">in</span> the least number <span class="hljs-keyword">of</span> steps.

You should only respond <span class="hljs-keyword">in</span> JSON format <span class="hljs-keyword">as</span> described below
Response Format:
{
    <span class="hljs-string">"thoughts"</span>: {
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"thought"</span>,
        <span class="hljs-string">"reasoning"</span>: <span class="hljs-string">"reasoning"</span>,
        <span class="hljs-string">"plan"</span>: <span class="hljs-string">"- short bulleted\n- list that conveys\n- long-term plan"</span>,
        <span class="hljs-string">"criticism"</span>: <span class="hljs-string">"constructive self-criticism"</span>,
        <span class="hljs-string">"speak"</span>: <span class="hljs-string">"thoughts summary to say to user"</span>
    },
    <span class="hljs-string">"command"</span>: {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"command name"</span>,
        <span class="hljs-string">"args"</span>: {
            <span class="hljs-string">"arg name"</span>: <span class="hljs-string">"value"</span>
        }
    }
}
Ensure the response can be parsed <span class="hljs-keyword">by</span> Python json.loads<span class="hljs-comment">'</span>
</code></pre>
<blockquote>
<p>上述 prompt 中关于 tennis 的部分是可变的，是我输入给它的</p>
</blockquote>
<p>这段 prompt 中我能够快速学到的经验是，如果想得到一些格式化的输出，可以直接让 GPT 生成 JSON 字符串。</p>
<pre><code class="hljs language-swift"><span class="hljs-type">You</span> should only respond <span class="hljs-keyword">in</span> <span class="hljs-type">JSON</span> format <span class="hljs-keyword">as</span> described below
<span class="hljs-type">Response</span> <span class="hljs-type">Format</span>:
{
    <span class="hljs-string">"thoughts"</span>: {
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"thought"</span>,
        <span class="hljs-string">"reasoning"</span>: <span class="hljs-string">"reasoning"</span>,
        <span class="hljs-string">"plan"</span>: <span class="hljs-string">"- short bulleted<span class="hljs-subst">\n</span>- list that conveys<span class="hljs-subst">\n</span>- long-term plan"</span>,
        <span class="hljs-string">"criticism"</span>: <span class="hljs-string">"constructive self-criticism"</span>,
        <span class="hljs-string">"speak"</span>: <span class="hljs-string">"thoughts summary to say to user"</span>
    },
    <span class="hljs-string">"command"</span>: {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"command name"</span>,
        <span class="hljs-string">"args"</span>: {
            <span class="hljs-string">"arg name"</span>: <span class="hljs-string">"value"</span>
        }
    }
}
<span class="hljs-type">Ensure</span> the response can be parsed by <span class="hljs-type">Python</span> json.loads'
</code></pre>
<p>我之前的做法是让 GPT 生成纯文本，然后用正则去匹配，除了正则匹配麻烦之外，生成纯文本并不一定会完全按照预期的格式，比如如下 prompt</p>
<pre><code class="hljs language-vbnet">You should only respond <span class="hljs-keyword">as</span> described below
<span class="hljs-symbol">options:</span>
    <span class="hljs-number">1</span>. <span class="hljs-keyword">option</span> <span class="hljs-number">1</span>
    <span class="hljs-number">2</span>. <span class="hljs-keyword">option</span> <span class="hljs-number">2</span>
</code></pre>
<p>GPT 可能会自由发挥一下，生成</p>
<pre><code class="hljs language-markdown">your options are:
<span class="hljs-bullet">    1.</span> option 1
<span class="hljs-bullet">    2.</span> option 2
</code></pre>
<p>Prompt 中其他 trick 还待我继续探索。</p>
<h2>记忆</h2>
<p>为什么需要记忆，和 GPT 多轮对话时，把所有聊天历史都输入给 GPT，token 数量不够，所以希望把历史会话存储下来，下次和 GPT 对话时，冲历史对话（记忆）中找到相关的内容，然后把相关的内容输入给 GPT，这样 GPT 就可以更好的理解当前的对话。</p>
<p>主要看看 <a href="https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L29">LocalCache</a> 中 <a href="https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L62">add</a> 和 <a href="https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L113">get_relevant</a> 的实现</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>):
    // 存储原始的 text
    self.data.texts.append(text)

    embedding = create_embedding_with_ada(text)

    vector = np.array(embedding).astype(np.float32)
    vector = vector[np.newaxis, :]
    // 存储 text 对应的 embedding
    self.data.embeddings = np.concatenate(
        [
            self.data.embeddings,
            vector,
        ],
        axis=<span class="hljs-number">0</span>,
    )
</code></pre>
<p>根据当前的 text 的 embedding，和历史对话中的所有 text 的 embedding 计算点积，然后取 top k，返回相关的 text</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_relevant</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span></span>) -> <span class="hljs-built_in">list</span>[<span class="hljs-type">Any</span>]:
    embedding = create_embedding_with_ada(text)

    scores = np.dot(self.data.embeddings, embedding)

    top_k_indices = np.argsort(scores)[-k:][::-<span class="hljs-number">1</span>]

    <span class="hljs-keyword">return</span> [self.data.texts[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_k_indices]
</code></pre></div></article></main><div class="layout_backToHome__9sjx_"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"14_autogpt_learn","contentHtml":"\u003cp\u003e项目地址：\u003ca href=\"https://github.com/Significant-Gravitas/Auto-GPT\"\u003ehttps://github.com/Significant-Gravitas/Auto-GPT\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003ePrompt 构造\u003c/h2\u003e\n\u003cp\u003eAutoGPT 的 prompt \u003ca href=\"https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/chat.py#L27-L49\"\u003e包含多条 message\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e这里主要看看其中一条，也是最主要的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-vbnet\"\u003e\u003cspan class=\"hljs-comment\"\u003e'You are Tennis-GPT, An AI for creating tennis training plan\u003c/span\u003e\nYour decisions must always be made independently without seeking user assistance. Play \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e your strengths \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e an LLM \u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e pursue simple strategies \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e no legal complications.\n\n\u003cspan class=\"hljs-symbol\"\u003eGOALS:\u003c/span\u003e\n\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. Aim \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e achieve an amateur level \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2.5\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e tennis beginners.\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. Practice at home.\n\n\n\u003cspan class=\"hljs-symbol\"\u003eConstraints:\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. ~\u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e word limit \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eshort\u003c/span\u003e term memory. Your \u003cspan class=\"hljs-type\"\u003eshort\u003c/span\u003e term memory \u003cspan class=\"hljs-built_in\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eshort\u003c/span\u003e, so immediately save important information \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e files.\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. \u003cspan class=\"hljs-keyword\"\u003eIf\u003c/span\u003e you are unsure how you previously did something \u003cspan class=\"hljs-built_in\"\u003eor\u003c/span\u003e want \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e recall past events, thinking about similar events will help you remember.\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e. No user assistance\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e. Exclusively use the commands listed \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e quotes e.g. \u003cspan class=\"hljs-string\"\u003e\"command name\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-symbol\"\u003eCommands:\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. Google Search: \u003cspan class=\"hljs-string\"\u003e\"google\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"input\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;search\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. Browse Website: \u003cspan class=\"hljs-string\"\u003e\"browse_website\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"url\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;url\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"question\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;what_you_want_to_find_on_website\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e. Start GPT Agent: \u003cspan class=\"hljs-string\"\u003e\"start_agent\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;name\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"task\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;short_task_desc\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"prompt\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;prompt\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e. Message GPT Agent: \u003cspan class=\"hljs-string\"\u003e\"message_agent\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"key\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;key\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"message\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;message\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e. List GPT Agents: \u003cspan class=\"hljs-string\"\u003e\"list_agents\"\u003c/span\u003e, args:\n\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e. Delete GPT Agent: \u003cspan class=\"hljs-string\"\u003e\"delete_agent\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"key\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;key\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e. Clone Repository: \u003cspan class=\"hljs-string\"\u003e\"clone_repository\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"repository_url\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;url\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"clone_path\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;directory\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e. Write \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e file: \u003cspan class=\"hljs-string\"\u003e\"write_to_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;text\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e. Read file: \u003cspan class=\"hljs-string\"\u003e\"read_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e. Append \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e file: \u003cspan class=\"hljs-string\"\u003e\"append_to_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;text\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e. Delete file: \u003cspan class=\"hljs-string\"\u003e\"delete_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e. Search Files: \u003cspan class=\"hljs-string\"\u003e\"search_files\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"directory\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;directory\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e. Evaluate Code: \u003cspan class=\"hljs-string\"\u003e\"evaluate_code\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;full_code_string\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e. \u003cspan class=\"hljs-keyword\"\u003eGet\u003c/span\u003e Improved Code: \u003cspan class=\"hljs-string\"\u003e\"improve_code\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"suggestions\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;list_of_suggestions\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;full_code_string\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e. Write Tests: \u003cspan class=\"hljs-string\"\u003e\"write_tests\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"code\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;full_code_string\u003e\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"focus\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;list_of_focus_areas\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e. Execute Python File: \u003cspan class=\"hljs-string\"\u003e\"execute_python_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e. Generate Image: \u003cspan class=\"hljs-string\"\u003e\"generate_image\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"prompt\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;prompt\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e. Send Tweet: \u003cspan class=\"hljs-string\"\u003e\"send_tweet\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;text\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e19\u003c/span\u003e. Convert Audio \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etext\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"read_audio_from_file\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"file\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;file\u003e\"\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e. \u003cspan class=\"hljs-keyword\"\u003eDo\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eNothing\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"do_nothing\"\u003c/span\u003e, args:\n\u003cspan class=\"hljs-number\"\u003e21\u003c/span\u003e. Task Complete (Shutdown): \u003cspan class=\"hljs-string\"\u003e\"task_complete\"\u003c/span\u003e, args: \u003cspan class=\"hljs-string\"\u003e\"reason\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;reason\u003e\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-symbol\"\u003eResources:\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. Internet access \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e searches \u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e information gathering.\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. \u003cspan class=\"hljs-type\"\u003eLong\u003c/span\u003e Term memory management.\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e. GPT-\u003cspan class=\"hljs-number\"\u003e3.5\u003c/span\u003e powered Agents \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e delegation \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e simple tasks.\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e. File output.\n\nPerformance Evaluation:\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. Continuously review \u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e analyze your actions \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e ensure you are performing \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e the best \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e your abilities.\n\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. Constructively self-criticize your big-picture behavior constantly.\n\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e. Reflect \u003cspan class=\"hljs-keyword\"\u003eon\u003c/span\u003e past decisions \u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e strategies \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e refine your approach.\n\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e. Every command has a cost, so be smart \u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e efficient. Aim \u003cspan class=\"hljs-keyword\"\u003eto\u003c/span\u003e complete tasks \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e the least number \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e steps.\n\nYou should only respond \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e JSON format \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e described below\nResponse Format:\n{\n    \u003cspan class=\"hljs-string\"\u003e\"thoughts\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"thought\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"reasoning\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"reasoning\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"plan\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"- short bulleted\\n- list that conveys\\n- long-term plan\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"criticism\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"constructive self-criticism\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"speak\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"thoughts summary to say to user\"\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-string\"\u003e\"command\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"command name\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"args\"\u003c/span\u003e: {\n            \u003cspan class=\"hljs-string\"\u003e\"arg name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e\n        }\n    }\n}\nEnsure the response can be parsed \u003cspan class=\"hljs-keyword\"\u003eby\u003c/span\u003e Python json.loads\u003cspan class=\"hljs-comment\"\u003e'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上述 prompt 中关于 tennis 的部分是可变的，是我输入给它的\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e这段 prompt 中我能够快速学到的经验是，如果想得到一些格式化的输出，可以直接让 GPT 生成 JSON 字符串。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-swift\"\u003e\u003cspan class=\"hljs-type\"\u003eYou\u003c/span\u003e should only respond \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eJSON\u003c/span\u003e format \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e described below\n\u003cspan class=\"hljs-type\"\u003eResponse\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eFormat\u003c/span\u003e:\n{\n    \u003cspan class=\"hljs-string\"\u003e\"thoughts\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"text\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"thought\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"reasoning\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"reasoning\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"plan\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"- short bulleted\u003cspan class=\"hljs-subst\"\u003e\\n\u003c/span\u003e- list that conveys\u003cspan class=\"hljs-subst\"\u003e\\n\u003c/span\u003e- long-term plan\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"criticism\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"constructive self-criticism\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"speak\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"thoughts summary to say to user\"\u003c/span\u003e\n    },\n    \u003cspan class=\"hljs-string\"\u003e\"command\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"command name\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"args\"\u003c/span\u003e: {\n            \u003cspan class=\"hljs-string\"\u003e\"arg name\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"value\"\u003c/span\u003e\n        }\n    }\n}\n\u003cspan class=\"hljs-type\"\u003eEnsure\u003c/span\u003e the response can be parsed by \u003cspan class=\"hljs-type\"\u003ePython\u003c/span\u003e json.loads'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e我之前的做法是让 GPT 生成纯文本，然后用正则去匹配，除了正则匹配麻烦之外，生成纯文本并不一定会完全按照预期的格式，比如如下 prompt\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-vbnet\"\u003eYou should only respond \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e described below\n\u003cspan class=\"hljs-symbol\"\u003eoptions:\u003c/span\u003e\n    \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e. \u003cspan class=\"hljs-keyword\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e. \u003cspan class=\"hljs-keyword\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eGPT 可能会自由发挥一下，生成\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-markdown\"\u003eyour options are:\n\u003cspan class=\"hljs-bullet\"\u003e    1.\u003c/span\u003e option 1\n\u003cspan class=\"hljs-bullet\"\u003e    2.\u003c/span\u003e option 2\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePrompt 中其他 trick 还待我继续探索。\u003c/p\u003e\n\u003ch2\u003e记忆\u003c/h2\u003e\n\u003cp\u003e为什么需要记忆，和 GPT 多轮对话时，把所有聊天历史都输入给 GPT，token 数量不够，所以希望把历史会话存储下来，下次和 GPT 对话时，冲历史对话（记忆）中找到相关的内容，然后把相关的内容输入给 GPT，这样 GPT 就可以更好的理解当前的对话。\u003c/p\u003e\n\u003cp\u003e主要看看 \u003ca href=\"https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L29\"\u003eLocalCache\u003c/a\u003e 中 \u003ca href=\"https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L62\"\u003eadd\u003c/a\u003e 和 \u003ca href=\"https://github.com/Significant-Gravitas/Auto-GPT/blob/fdd79223b0c6132e1d7fc5127e9ca02fabaea9e5/autogpt/memory/local.py#L113\"\u003eget_relevant\u003c/a\u003e 的实现\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eadd\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, text: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e\u003c/span\u003e):\n    // 存储原始的 text\n    self.data.texts.append(text)\n\n    embedding = create_embedding_with_ada(text)\n\n    vector = np.array(embedding).astype(np.float32)\n    vector = vector[np.newaxis, :]\n    // 存储 text 对应的 embedding\n    self.data.embeddings = np.concatenate(\n        [\n            self.data.embeddings,\n            vector,\n        ],\n        axis=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    )\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e根据当前的 text 的 embedding，和历史对话中的所有 text 的 embedding 计算点积，然后取 top k，返回相关的 text\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eget_relevant\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eself, text: \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e, k: \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e\u003c/span\u003e) -\u003e \u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e[\u003cspan class=\"hljs-type\"\u003eAny\u003c/span\u003e]:\n    embedding = create_embedding_with_ada(text)\n\n    scores = np.dot(self.data.embeddings, embedding)\n\n    top_k_indices = np.argsort(scores)[-k:][::-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e [self.data.texts[i] \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e top_k_indices]\n\u003c/code\u003e\u003c/pre\u003e","title":"从 AutoGPT 学习如何发挥 GPT 的潜力","date":"2023-04-19"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"14_autogpt_learn"},"buildId":"AXSw0rpNiwbWX6q4wUGrM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>